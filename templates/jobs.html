{% extends "base.html" %} {% from "_components.html" import topbar, btn %} {%
block content %}
<div class="max-w-4xl mx-auto p-5">
    {{ topbar( title="Jobs", actions=[ {'label': '‚Üê Back', 'href': '/',
    'variant': 'outline'}, {'label': 'üìö Templates', 'href': '/templates',
    'variant': 'outline'}, {'label': '‚öôÔ∏è Settings', 'href': '/settings',
    'variant': 'outline'} ], show_theme_toggle=True ) }}
    <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-6">
        <div class="flex items-center justify-end gap-2 mb-3 flex-wrap">
            <div class="flex items-center gap-2">
                {{ btn('üîÑ Refresh', variant='primary', size='sm',
                id='refreshBtn') }}
                <label
                    class="inline-flex items-center gap-2 text-sm text-slate-700 dark:text-slate-200"
                >
                    <input
                        type="checkbox"
                        id="autoRefresh"
                        class="h-4 w-4"
                        checked
                    />
                    Auto-refresh
                </label>
            </div>
        </div>

        <div class="overflow-x-auto">
            <table class="w-full text-sm">
                <thead>
                    <tr class="bg-slate-100 dark:bg-slate-700">
                        <th class="text-left px-2.5 py-2">ID</th>
                        <th class="text-left px-2.5 py-2">Type</th>
                        <th class="text-left px-2.5 py-2">Status</th>
                        <th class="text-left px-2.5 py-2">Created</th>
                        <th class="text-left px-2.5 py-2">Updated</th>
                        <th class="text-left px-2.5 py-2">Meta</th>
                    </tr>
                </thead>
                <tbody>
                    {% for j in jobs %}
                    <tr class="border-b border-gray-200 dark:border-slate-700">
                        <td class="px-2.5 py-2 font-mono">
                            <a
                                href="/jobs/{{ j.id }}"
                                target="_blank"
                                class="text-brand hover:text-brand-dark underline"
                                >{{ j.id[:8] }}</a
                            >
                        </td>
                        <td class="px-2.5 py-2">{{ j.type }}</td>
                        <td
                            class="px-2.5 py-2 font-semibold {% if j.status == 'queued' %} text-slate-600 dark:text-slate-300 {% elif j.status == 'running' %} text-blue-600 dark:text-blue-400 {% elif j.status == 'success' %} text-green-700 dark:text-green-400 {% elif j.status == 'error' %} text-red-600 dark:text-red-400 {% else %} text-slate-700 dark:text-slate-200 {% endif %}"
                        >
                            {{ j.status }}
                        </td>
                        <td class="px-2.5 py-2 font-mono">
                            {{ j.created_at }}
                        </td>
                        <td class="px-2.5 py-2 font-mono">
                            {{ j.updated_at }}
                        </td>
                        <td class="px-2.5 py-2 font-mono">
                            {% if j.total %}total={{ j.total }} {% endif %}{% if
                            j.origin %}origin={{ j.origin }}{% endif %}
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td
                            colspan="6"
                            class="px-2.5 py-6 text-center text-slate-500"
                        >
                            No jobs yet.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    (function () {
        const btn = document.getElementById("refreshBtn");
        const auto = document.getElementById("autoRefresh");
        function reload() {
            window.location.reload();
        }
        if (btn) btn.addEventListener("click", reload);
        let timer = setInterval(() => {
            if (auto && auto.checked) reload();
        }, 5000);
    })();
</script>
{% endblock %}
